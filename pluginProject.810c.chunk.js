(window.webpackJsonp=window.webpackJsonp||[]).push([[22],{165:function(e,t,n){"use strict";n.r(t);var a=n(0);t.default=a.createElement("div",{className:"markdown-body"},a.createElement("div",null,a.createElement("h1",null,"Project"),a.createElement("p",null,"Use ",a.createElement("code",null,".project")," to extend project operator."),a.createElement("h2",null,"getProjectRootPath"),a.createElement("p",null,"Get project root path from ",a.createElement("code",null,"project.getProjectRootPath"),":"),a.createElement("pre",null,a.createElement("code",{className:"language-typescript"},a.createElement("span",{className:"hljs-keyword"},"import")," ","{"," pri ","}"," ",a.createElement("span",{className:"hljs-keyword"},"from")," ",a.createElement("span",{className:"hljs-string"},"'pri'"),";","\n","\n",a.createElement("span",{className:"hljs-keyword"},"export")," ",a.createElement("span",{className:"hljs-keyword"},"default")," (instance: ",a.createElement("span",{className:"hljs-keyword"},"typeof")," pri) => ","{","\n","  ",a.createElement("span",{className:"hljs-keyword"},"const")," projectRootPath = instance.project.getProjectRootPath();","\n","}",";","\n")),a.createElement("h2",null,"getProjectConfig"),a.createElement("p",null,"Get project config by env: ",a.createElement("code",null,"local")," or ",a.createElement("code",null,"prod"),"."),a.createElement("pre",null,a.createElement("code",{className:"language-typescript"},a.createElement("span",{className:"hljs-keyword"},"import")," ","{"," pri ","}"," ",a.createElement("span",{className:"hljs-keyword"},"from")," ",a.createElement("span",{className:"hljs-string"},"'pri'"),";","\n","\n",a.createElement("span",{className:"hljs-keyword"},"export")," ",a.createElement("span",{className:"hljs-keyword"},"default")," (instance: ",a.createElement("span",{className:"hljs-keyword"},"typeof")," pri) => ","{","\n","  ",a.createElement("span",{className:"hljs-keyword"},"const")," projectConfig = instance.project.getProjectConfig(",a.createElement("span",{className:"hljs-string"},"'prod'"),");","\n","}",";","\n")),a.createElement("h2",null,"onAnalyseProject"),a.createElement("p",null,"Every time ",a.createElement("code",null,"pri")," scan project files."),a.createElement("p",null,a.createElement("strong",null,a.createElement("code",null,"./src/index.ts"))),a.createElement("pre",null,a.createElement("code",{className:"language-typescript"},a.createElement("span",{className:"hljs-keyword"},"import")," ","{"," pri ","}"," ",a.createElement("span",{className:"hljs-keyword"},"from")," ",a.createElement("span",{className:"hljs-string"},"'pri'"),";","\n","\n","interface IAnalyseInfo ","{","\n","  ",a.createElement("span",{className:"hljs-attr"},"myCustomPlugin"),": ","{","\n","    ",a.createElement("span",{className:"hljs-attr"},"hasComponents"),": boolean;","\n","  ","}",";","\n","}","\n","\n",a.createElement("span",{className:"hljs-keyword"},"export")," ",a.createElement("span",{className:"hljs-keyword"},"default")," (instance: ",a.createElement("span",{className:"hljs-keyword"},"typeof")," pri) => ","{","\n","  ","instance.project.onAnalyseProject(",a.createElement("span",{className:"hljs-function"},"(",a.createElement("span",{className:"hljs-params"},"files, env, projectConfig, setPipe"),") =>")," ","{","\n","    ",a.createElement("span",{className:"hljs-keyword"},"return")," ","{","\n","      ",a.createElement("span",{className:"hljs-attr"},"myCustomPlugin"),": ","{","\n","        ",a.createElement("span",{className:"hljs-attr"},"hasComponents"),": files.some(",a.createElement("span",{className:"hljs-function"},a.createElement("span",{className:"hljs-params"},"file")," =>")," ","{","\n","          ",a.createElement("span",{className:"hljs-keyword"},"const")," relativePath = path.relative(projectRootPath, path.join(file.dir, file.name));","\n","          ",a.createElement("span",{className:"hljs-keyword"},"return")," relativePath.startsWith(",a.createElement("span",{className:"hljs-string"},"'src/components'"),");","\n","        ","}",")","\n","      ","}","\n","    ","}"," ",a.createElement("span",{className:"hljs-keyword"},"as")," IAnalyseInfo;","\n","  ","}",");","\n","}",";","\n")),a.createElement("table",null,a.createElement("thead",null,a.createElement("tr",null,a.createElement("th",null,"Option"),a.createElement("th",null,"Description"))),a.createElement("tbody",null,a.createElement("tr",null,a.createElement("td",null,"files"),a.createElement("td",null,"All projectâ€™s files.")),a.createElement("tr",null,a.createElement("td",null,"env"),a.createElement("td",null,a.createElement("code",null,'"local"')," when excute ",a.createElement("code",null,"pri dev"),". ",a.createElement("br",null)," ",a.createElement("code",null,'"prod"')," when excute like ",a.createElement("code",null,"pri build")," and ",a.createElement("code",null,"pri preview")," other than ",a.createElement("code",null,"pri dev"),".")),a.createElement("tr",null,a.createElement("td",null,"projectConfig"),a.createElement("td",null,"See ",a.createElement("a",{href:"../config"},"Config"),".")))),a.createElement("h3",null,"Return value"),a.createElement("p",null,"The return value from ",a.createElement("code",null,"onAnalyseProject")," callback will merge into project analyse info, you can access it from ",a.createElement("code",null,"onCreateEntry"),"."),a.createElement("h2",null,"onCreateEntry"),a.createElement("p",null,"Every time ",a.createElement("code",null,"pri")," create entry file. You can get analyse info from first params in first callback function."),a.createElement("p",null,a.createElement("strong",null,a.createElement("code",null,"./src/index.ts"))),a.createElement("pre",null,a.createElement("code",{className:"language-typescript"},a.createElement("span",{className:"hljs-keyword"},"import")," ","{"," pri ","}"," ",a.createElement("span",{className:"hljs-keyword"},"from")," ",a.createElement("span",{className:"hljs-string"},"'pri'"),";","\n","\n",a.createElement("span",{className:"hljs-keyword"},"export")," ",a.createElement("span",{className:"hljs-keyword"},"default")," (instance: ",a.createElement("span",{className:"hljs-keyword"},"typeof")," pri) => ","{","\n","  ","instance.project.onCreateEntry(",a.createElement("span",{className:"hljs-function"},"(",a.createElement("span",{className:"hljs-params"},"analyseInfo: IAnalyseInfo, entry, env, projectConfig"),") =>")," ","{","\n","    ",a.createElement("span",{className:"hljs-comment"},"// Get analyseInfo from above."),"\n","    ",a.createElement("span",{className:"hljs-keyword"},"const")," hasComponents = analyseInfo.myCustomPlugin.hasComponents;","\n","\n","    ",a.createElement("span",{className:"hljs-keyword"},"const")," componentsRelativePath = path.relative(",a.createElement("span",{className:"hljs-string"},"'.temp'"),", ",a.createElement("span",{className:"hljs-string"},"'src/components'"),");","\n","\n","    ",a.createElement("span",{className:"hljs-keyword"},"if")," (hasComponents) ","{","\n","      ",a.createElement("span",{className:"hljs-comment"},"// Expand importer code before header."),"\n","      ","entry.pipeHeader(",a.createElement("span",{className:"hljs-function"},a.createElement("span",{className:"hljs-params"},"header")," =>")," ","{","\n","        ",a.createElement("span",{className:"hljs-keyword"},"return")," ",a.createElement("span",{className:"hljs-string"},"`","\n","          ","\\$\\","{","header\\","}","\n","          ",'import components from "\\$\\',"{","componentsRelativePath\\","}",'"',"\n","        ","`"),";","\n","      ","}",");","\n","    ","}","\n","  ","}",");","\n","}",";","\n")),a.createElement("h3",null,"Entry"),a.createElement("p",null,"You can use methods like ",a.createElement("code",null,"entry.pipeHeader")," and ",a.createElement("code",null,"entry.pipeBody")," to extend entry code. Usage:"),a.createElement("pre",null,a.createElement("code",{className:"language-typescript"},"entry.pipeBody(",a.createElement("span",{className:"hljs-function"},a.createElement("span",{className:"hljs-params"},"str")," =>")," str);","\n")),a.createElement("h3",null,"Entry structor"),a.createElement("p",null,"Here are some buit-in pipe position:"),a.createElement("p",null,a.createElement("strong",null,a.createElement("code",null,"app.tsx"))),a.createElement("pre",null,a.createElement("code",{className:"language-js"},"// ----- pipeAppHeader before","\n",'import createBrowserHistory from "history/createBrowserHistory"',"\n","import ","{"," setCustomEnv, setEnvLocal, setEnvProd ","}",' from "pri/client"',"\n",'import * as React from "react"',"\n",'import * as ReactDOM from "react-dom"',"\n",'import Loadable from "react-loadable"',"\n","import ","{"," Redirect, Route, Router, Switch ","}",' from "react-router-dom"',"\n","// ----- pipeAppHeader after","\n","\n","// ----- pipeAppBody before","\n","export const pageLoadableMap = new Map<string, any>()","\n","export const customHistory = createBrowserHistory(","{","\n","  ",'basename: ".." // baseHref from projectConfig',"\n","}",")","\n","// ----- pipeAppBody after","\n","\n","// ----- pipeAppComponent before","\n","export class App extends React.PureComponent<any, any> ","{","\n","  ","// ----- pipeAppClassBody before","\n","  ","// ----- pipeAppClassBody after","\n","\n","  ","public render() ","{","\n","    ","return (","\n","      ","// ----- pipeAppRouter before","\n","      ","<Router>","\n","        ","// ----- pipeAppRoutes before","\n","        ","// ----- pipeAppRoutes after","\n","      ","</Router>","\n","      ","// ----- pipeAppRouter after","\n","    ",")","\n","  ","}","\n","}","\n","// ----- pipeAppComponent after","\n")),a.createElement("p",null,a.createElement("strong",null,a.createElement("code",null,"entry.tsx"))),a.createElement("pre",null,a.createElement("code",{className:"language-js"},a.createElement("span",{className:"hljs-comment"},"// ----- pipeEntryHeader before"),"\n",a.createElement("span",{className:"hljs-keyword"},"import")," * ",a.createElement("span",{className:"hljs-keyword"},"as")," React ",a.createElement("span",{className:"hljs-keyword"},"from")," ",a.createElement("span",{className:"hljs-string"},"'react'"),";","\n",a.createElement("span",{className:"hljs-keyword"},"import")," * ",a.createElement("span",{className:"hljs-keyword"},"as")," ReactDOM ",a.createElement("span",{className:"hljs-keyword"},"from")," ",a.createElement("span",{className:"hljs-string"},"'react-dom'"),";","\n",a.createElement("span",{className:"hljs-keyword"},"import")," App, ","{"," pageLoadableMap ","}"," ",a.createElement("span",{className:"hljs-keyword"},"from")," ",a.createElement("span",{className:"hljs-string"},"'./app'"),";","\n",a.createElement("span",{className:"hljs-comment"},"// ----- pipeEntryHeader after"),"\n","\n",a.createElement("span",{className:"hljs-comment"},"// ----- pipeEntryRender before"),"\n","ReactDOM.render(",a.createElement("span",{className:"xml"},a.createElement("span",{className:"hljs-tag"},"<",a.createElement("span",{className:"hljs-name"},"Root")," />"),", document.getElementById('root'));","\n","// ----- pipeEntryRender after","\n"))),a.createElement("h3",null,"Custom pipe"),a.createElement("p",null,"You can also get or set custom code position in plugins. Using ",a.createElement("code",null,"entry.pipe"),":"),a.createElement("pre",null,a.createElement("code",{className:"language-typescript"},"instance.project.onCreateEntry(",a.createElement("span",{className:"hljs-function"},"(",a.createElement("span",{className:"hljs-params"},"analyseInfo: IAnalyseInfo, entry, env, projectConfig"),") =>")," ","{","\n","  ","entry.pipeBody(",a.createElement("span",{className:"hljs-function"},a.createElement("span",{className:"hljs-params"},"body")," =>")," ","{","\n","    ",a.createElement("span",{className:"hljs-keyword"},"return")," ",a.createElement("span",{className:"hljs-string"},"`","\n","    ","\\$\\","{","body\\","}","\n","    ","some code after body.","\n","    ","\\$","{",'entry.pipe.get("my-custom-position", "defaultValue")',"}","\n","    ","some other code.","\n","  ","`"),";","\n","  ","}",");","\n","}",");","\n")),a.createElement("p",null,"And in other plugins, you can pipe custom position by using ",a.createElement("code",null,"setPipe")," inside ",a.createElement("code",null,"onAnalyseProject"),":"),a.createElement("pre",null,a.createElement("code",{className:"language-typescript"},"instance.project.onAnalyseProject(",a.createElement("span",{className:"hljs-function"},"(",a.createElement("span",{className:"hljs-params"},"files, env, projectConfig, setPipe"),") =>")," ","{","\n","  ","setPipe(",a.createElement("span",{className:"hljs-string"},"'my-custom-position'"),", text => ","{","\n","    ",a.createElement("span",{className:"hljs-keyword"},"return")," ",a.createElement("span",{className:"hljs-string"},"`","\n","    ","\\$\\","{","text\\","}","\n","    ","some code.","\n","  ","`"),";","\n","  ","}",");","\n","}",");","\n")),a.createElement("p",null,a.createElement("strong",null,a.createElement("code",null,"pipe"))),a.createElement("table",null,a.createElement("thead",null,a.createElement("tr",null,a.createElement("th",null,"Option"),a.createElement("th",null,"Params"),a.createElement("th",null,"Description"))),a.createElement("tbody",null,a.createElement("tr",null,a.createElement("td",null,"get"),a.createElement("td",null,a.createElement("code",null,"name: string"),", ",a.createElement("code",null,"defaultValue: string")),a.createElement("td",null,"Get custom pipe code.")),a.createElement("tr",null,a.createElement("td",null,"set"),a.createElement("td",null,a.createElement("code",null,"pipe: (str: string) => string")),a.createElement("td",null,"Set custom pipe code.")))),a.createElement("h2",null,"whiteFileRules"),a.createElement("p",null,"Pri uses a white list for project file management. You can use ",a.createElement("code",null,"whiteFileRules.add")," to add project white file list."),a.createElement("pre",null,a.createElement("code",{className:"language-typescript"},a.createElement("span",{className:"hljs-keyword"},"export")," ",a.createElement("span",{className:"hljs-keyword"},"default")," (instance: ",a.createElement("span",{className:"hljs-keyword"},"typeof")," pri) => ","{","\n","  ","instance.project.whiteFileRules.add(",a.createElement("span",{className:"hljs-function"},a.createElement("span",{className:"hljs-params"},"file")," =>")," ","{","\n","    ",a.createElement("span",{className:"hljs-keyword"},"const")," relativePath = path.relative(projectRootPath, file.dir)","\n","    ",a.createElement("span",{className:"hljs-keyword"},"return")," relativePath === ",a.createElement("span",{className:"hljs-string"},'"src/pages"')," && file.name === ",a.createElement("span",{className:"hljs-string"},'"404"')," && file.ext === ",a.createElement("span",{className:"hljs-string"},'".tsx"'),"\n","  ","}",")","\n","}",")","\n")),a.createElement("p",null,"It mean that file or dir is validate, when return ",a.createElement("code",null,"true"),"."),a.createElement("blockquote",null,a.createElement("p",null,"Any project files that are not on the white list will report error.")),a.createElement("h2",null,"lint"),a.createElement("p",null,"You can run lint anywhere by execute ",a.createElement("code",null,"project.lint()"),":"),a.createElement("pre",null,a.createElement("code",{className:"language-typescript"},a.createElement("span",{className:"hljs-keyword"},"import")," ","{"," pri ","}"," ",a.createElement("span",{className:"hljs-keyword"},"from")," ",a.createElement("span",{className:"hljs-string"},"'pri'"),";","\n","\n",a.createElement("span",{className:"hljs-keyword"},"export")," ",a.createElement("span",{className:"hljs-keyword"},"default")," (instance: ",a.createElement("span",{className:"hljs-keyword"},"typeof")," pri) => ","{","\n","  ","instance.project.lint();","\n","}",";","\n")),a.createElement("h2",null,"checkProjectFiles"),a.createElement("p",null,"Check project white file list."),a.createElement("p",null,a.createElement("code",null,"pri dev")," and ",a.createElement("code",null,"pri build")," has built in ",a.createElement("code",null,"checkProjectFiles")," function, you can call this function when add a new command."),a.createElement("pre",null,a.createElement("code",{className:"language-typescript"},a.createElement("span",{className:"hljs-keyword"},"import")," ","{"," pri ","}"," ",a.createElement("span",{className:"hljs-keyword"},"from")," ",a.createElement("span",{className:"hljs-string"},"'pri'"),";","\n","\n",a.createElement("span",{className:"hljs-keyword"},"export")," ",a.createElement("span",{className:"hljs-keyword"},"default")," (instance: ",a.createElement("span",{className:"hljs-keyword"},"typeof")," pri) => ","{","\n","  ",a.createElement("span",{className:"hljs-keyword"},"const")," projectConfig = instance.project.getProjectConfig(",a.createElement("span",{className:"hljs-string"},"'prod'"),");","\n","  ",a.createElement("span",{className:"hljs-keyword"},"await")," instance.project.checkProjectFiles(projectConfig);","\n","}",";","\n")),a.createElement("h2",null,"ensureProjectFiles"),a.createElement("p",null,"Ensure important files exist, like ",a.createElement("code",null,".gitignore"),", ",a.createElement("code",null,".npmignore")," and so on. You can call it in a custom command."),a.createElement("p",null,"This method will called when excute ",a.createElement("code",null,"pri init"),", ",a.createElement("code",null,"pri"),", ",a.createElement("code",null,"pri build"),"."),a.createElement("pre",null,a.createElement("code",{className:"language-typescript"},a.createElement("span",{className:"hljs-keyword"},"import")," ","{"," pri ","}"," ",a.createElement("span",{className:"hljs-keyword"},"from")," ",a.createElement("span",{className:"hljs-string"},"'pri'"),";","\n","\n",a.createElement("span",{className:"hljs-keyword"},"export")," ",a.createElement("span",{className:"hljs-keyword"},"default")," (instance: ",a.createElement("span",{className:"hljs-keyword"},"typeof")," pri) => ","{","\n","  ",a.createElement("span",{className:"hljs-keyword"},"const")," projectConfig = instance.project.getProjectConfig(",a.createElement("span",{className:"hljs-string"},"'prod'"),");","\n","  ",a.createElement("span",{className:"hljs-keyword"},"await")," instance.project.ensureProjectFiles(projectConfig);","\n","}",";","\n")),a.createElement("h2",null,"addProjectFiles"),a.createElement("p",null,"Hook when running ",a.createElement("code",null,"addProjectFiles"),", you can add your custom files here:"),a.createElement("pre",null,a.createElement("code",{className:"language-typescript"},a.createElement("span",{className:"hljs-keyword"},"import")," ","{"," pri ","}"," ",a.createElement("span",{className:"hljs-keyword"},"from")," ",a.createElement("span",{className:"hljs-string"},"'pri'"),";","\n","\n",a.createElement("span",{className:"hljs-keyword"},"export")," ",a.createElement("span",{className:"hljs-keyword"},"default")," (instance: ",a.createElement("span",{className:"hljs-keyword"},"typeof")," pri) => ","{","\n","  ","instance.project.addProjectFiles(","{","\n","    ",a.createElement("span",{className:"hljs-attr"},"fileName"),": ",a.createElement("span",{className:"hljs-string"},"'abc.json'"),",","\n","    ",a.createElement("span",{className:"hljs-attr"},"pipeContent"),": ",a.createElement("span",{className:"hljs-function"},a.createElement("span",{className:"hljs-params"},"prevContent")," =>"),"\n","      ",a.createElement("span",{className:"hljs-built_in"},"JSON"),".stringify(","{","\n","        ",a.createElement("span",{className:"hljs-attr"},"bin"),": ",a.createElement("span",{className:"hljs-string"},"'npm start'"),"\n","      ","}",")","\n","  ","}",");","\n","}",";","\n"))))}}]);